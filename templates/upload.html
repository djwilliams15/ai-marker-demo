<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload Assessments for AI Marking</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        form {
            max-width: 600px;
        }
        label {
            font-weight: bold;
            display: block;
            margin-top: 15px;
        }
        input[type="text"],
        input[type="email"],
        select,
        input[type="file"],
        textarea {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            margin-top: 5px;
        }
        input[type="submit"] {
            margin-top: 20px;
            padding: 10px 15px;
            font-size: 1em;
        }
        /* Styling for the progress bar */
        #progressBar {
            width: 100%;
            background-color: #ddd;
            border: 1px solid #ccc;
            margin-top: 20px;
            display: none;
        }
        #progressBar div {
            width: 0%;
            height: 30px;
            background-color: #4caf50;
            text-align: center;
            line-height: 30px;
            color: white;
        }
        /* Style for the completion message */
        #uploadComplete {
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Upload PDFs for AI Marking</h1>
    <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
        <label for="subject">Choose a subject:</label>
        <select name="subject" id="subject" required>
          <option value="Physics">Physics</option>
          <option value="Maths">Maths</option>
          <option value="English">English</option>
          <option value="History">History</option>
          <option value="Geography">Geography</option>
        </select>
      
        <label for="exam_board">Choose an exam board:</label>
        <select name="exam_board" id="exam_board" required>
          <option value="AQA">AQA</option>
          <option value="Edexcel">Edexcel</option>
          <option value="OCR">OCR</option>
          <option value="WJEC">WJEC</option>
        </select>
      
        <label for="markscheme_file">Upload mark scheme (PDF):</label>
        <input type="file" name="markscheme_file" id="markscheme_file" required>
      
        <label for="student_files">Upload student responses (PDFs):</label>
        <input type="file" name="student_files" id="student_files" multiple required>
      
        <!-- Email input will be optional based on selection -->
        <label for="teacher_email">Your Email Address:</label>
        <input type="email" name="teacher_email" id="teacher_email" placeholder="Enter your email">
      
        <label for="additional_info"><strong>Additional Instructions / Information:</strong></label>
        <textarea name="additional_info" id="additional_info" rows="5" placeholder="Enter any extra details about the assessment here..."></textarea>
        
        <!-- DELIVERY OPTIONS -->
        <label><strong>How would you like to receive feedback?</strong></label>
        <div>
          <input type="checkbox" id="del_web" name="delivery_option" value="website" checked>
          <label for="del_web">View feedback on website</label>
        </div>
        <div>
          <input type="checkbox" id="del_email" name="delivery_option" value="email">
          <label for="del_email">Send feedback via email</label>
        </div>
        <br>

        <input type="submit" value="Upload and Mark">
    </form>

    <!-- Progress bar -->
    <div id="progressBar">
        <div>0%</div>
    </div>

    <!-- Completion message -->
    <div id="uploadComplete">
        <h2>Upload Complete!</h2>
        <p id="completeMessage">Your files have been uploaded and processed.</p>
    </div>
    
    <script>
        // Toggle email required when checkbox changes
        const emailInput = document.getElementById('teacher_email');
        const emailCheckbox = document.getElementById('del_email');
        const webCheckbox = document.getElementById('del_web');

        function updateEmailRequirement() {
            emailInput.required = emailCheckbox.checked;
        }
        emailCheckbox.addEventListener('change', updateEmailRequirement);
        document.addEventListener('DOMContentLoaded', updateEmailRequirement);

        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            const wantWeb = webCheckbox.checked;
            const wantEmail = emailCheckbox.checked;

            // Must select at least one
            if (!wantWeb && !wantEmail) {
                e.preventDefault();
                alert('Please select at least one delivery option.');
                return;
            }

            // If website chosen, proceed with full page submit for online feedback
            if (wantWeb) {
                return; // default browser submit
            }

            // Otherwise (email only), use AJAX and show completion message
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const xhr = new XMLHttpRequest();
            xhr.open(form.method, form.action, true);

            // Show progress bar
            const progressBar = document.getElementById('progressBar');
            const progressBarFill = progressBar.firstElementChild;
            progressBar.style.display = 'block';

            xhr.upload.addEventListener('progress', function(evt) {
                if (evt.lengthComputable) {
                    const percentComplete = Math.round((evt.loaded / evt.total) * 100);
                    progressBarFill.style.width = percentComplete + '%';
                    progressBarFill.textContent = percentComplete + '%';
                }
            }, false);

            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    // Hide form and progress bar
                    form.style.display = 'none';
                    progressBar.style.display = 'none';
                    // Show dynamic completion message
                    const completeMsg = document.getElementById('completeMessage');
                    completeMsg.textContent = wantEmail ?
                        'Your feedback is being emailed to you.' :
                        'Your files have been uploaded and processed.';
                    document.getElementById('uploadComplete').style.display = 'block';
                }
            };

            xhr.send(formData);
        });
    </script>
</body>
</html>
